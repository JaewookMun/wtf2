<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<aside th:fragment="f-left" id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
    <div class="app-brand demo">
        <a href="/" class="app-brand-link">
            <span>WTF2</span>
        </a>
        <span href="#" class="layout-menu-toggle d-xl-none"></span>
    </div>
    <div class="menu-inner-shadow"></div>

    <ul class="menu-inner py-1">
        <!-- Dashboard -->
<!--            <li class="menu-item active">-->
        <li class="menu-item">
            <a href="/" class="menu-link">
                <i class="menu-icon tf-icons bx bx-home-circle"></i>
                <div data-i18n="Analytics">Dashboard</div>
            </a>
        </li>
        <li class="menu-item">
            <a href="/notice-board" class="menu-link">
                <i class="menu-icon bx bxs-dashboard"></i>
                <div data-i18n="Analytics">공지사항</div>
            </a>
        </li>

        <!-- custom -->
        <div id="menuHeader" class="menu-header small text-uppercase not-draggable">
            <div role="standard" class="d-flex justify-content-between">
                <span role="button" class="menu-header-text">Pages</span>
                <div><i role="button" class='bx bx-plus' onclick="addSubPageBlock()"></i></div>
            </div>
            <div class="item-group d-none" th:unless="${#lists.isEmpty(pages)}">
                <div th:each="page : ${pages}" class="menu-item">
                    <a role="page" th:href="@{/notice-board/details/{id}(id=${page.id})}" href="/" class="menu-link justify-content-between p-0 pt-1">
                        <div class=""><i class="menu-icon tf-icons bx bx-cube-alt"></i></div>
                        <div th:text="${page.title}">ROOT</div>
                        <div class="ms-auto">
                            <i role="button" th:id="${'btn' + page.id}" class="bx bx-plus" th:onclick="'addSubPageBlock(' + ${page.id} + ', event)'"></i>
                        </div>
                    </a>
                    <div class="item-group d-none"></div>
                </div>
            </div>
        </div>


        <!--     origin       -->
        <li class="menu-item">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
                <i class="menu-icon tf-icons bx bx-cube-alt"></i>
                <div data-i18n="Board">게시판</div>
            </a>
            <ul class="menu-sub">
                <li class="menu-item">
                    <a href="/" class="menu-link">
                        <div data-i18n="notice">item</div>
                    </a>
                </li>
            </ul>
        </li>
        <li class="menu-item">
            <a href="/organization" class="menu-link">
                <i class="menu-icon tf-icons bx bxs-user"></i>
                <div data-i18n="User">조직도</div>
            </a>
        </li>
    </ul>

    <script th:inline="javascript">
        $(function() {
            console.log('left layout init');

            initWorkSpaceTree();
        });

        function initWorkSpaceTree() {
            // menu layout
            $('#menuHeader .menu-header-text').click(function() {
                $(this).parent('div[role="standard"]').siblings('.item-group').toggleClass('d-none');
            });

            $('#menuHeader').find('a.menu-link').click(e => changeDefaultListener(e, e.currentTarget));
        }

        function addSubPageBlock(id, e) {
            // e.preventDefault();
            // e.stopPropagation();

            let subItemGroup = $('#btn' + id).closest('a[role="page"]').next('.item-group');
            if(subItemGroup.hasClass('d-none')) subItemGroup.removeClass('d-none');

            let subPageId = postSubPage(id);

            console.log('sub ', subPageId);

            let pageBlock =
                '<div class="menu-item">' +
                    '<a role="page" href="/notice-board/details/' + subPageId + '" class="menu-link justify-content-between p-0 pt-1">' +
                        '<div><i class="menu-icon tf-icon bx bx-cube-alt"></i></div>' +
                        '<div>제목없음</div>' +
                        '<div class="ms-auto">' +
                            '<i role="button" id="btn' + subPageId + '" class="bx bx-plus" onclick="addSubPageBlock(' + subPageId + ', event)"></i>' +
                        '</div>' +
                    '</a>' +
                    '<div class="item-group d-none"></div>' +
                '</div>';

            subItemGroup.append(pageBlock);
            subItemGroup.find('a.menu-link').click(e => changeDefaultListener(e, e.currentTarget));
        }

        function changeDefaultListener(e, aTag) {
            e.preventDefault();

            // let isEmpty = $('#pageContext').empty();
            // console.log('isEmpty> ', isEmpty);

            console.log('href> ', $(aTag).prop('href'));
            $('#pageContext').load($(aTag).prop('href'));

            // // URL 변경 (페이지 새로고침 없이)
            // history.pushState(null, '', $(aTag).prop('href'));
        }

        function postSubPage(parentId) {
            let subPageId = -1;

            $.ajax({
                url: '/boards/page',
                method: 'POST',
                data: {'parentId': parentId},
                async: false,
                success: function(res) {
                    subPageId = res.data;
                }
            });

            return subPageId;
        }

    </script>
</aside>
</html>
